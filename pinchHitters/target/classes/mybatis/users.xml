<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="users">
    
	<insert id="create" parameterType="UsersDTO">
		insert into users(u_ID, name, passwd, age, sex, phone, address, address2, zipcode, email, u_date, fname)
		values(#{u_ID}, #{name}, #{passwd}, #{age}, #{sex}, #{phone}, 
			#{address}, #{address2}, #{zipcode}, #{email}, to_char(sysdate, 'yyyy-mm-dd'), #{fname})
	</insert>
	
	<select id="read" parameterType="String" resultType="UsersDTO">
		select u_ID, name, age, sex, phone, address, address2, zipcode, email, fname
		from users 
		where u_ID = #{u_ID}
	</select>
	
	<update id="update" parameterType="String">
		update users
		set age = #{age}, phone = #{phone}, address = #{address}, address2 = #{address2}, 
			zipcode = #{zipcode}, email = #{email}, fname = #{fname}
		where u_ID = #{u_ID}
	</update>
	
	<delete id="delete" parameterType="String">
		delete from users
		where u_ID = #{u_ID}
	</delete>
	
	<select id="list" parameterType="Map" resultType="UsersDTO">
		select u_ID, name, age, sex, address, r
		from(
			select u_ID, name, age, sex, address, rownum as r
			from users
			<where>
				<choose>
					<when test="col=='u_ID'">
						u_ID like '%'||#{word}||'%'
					</when>
					<when test="col=='name'">
						name like '%'||#{word}||'%'
					</when>
				</choose>
			</where>
		<![CDATA[
		)where r>=#{sno} and r<=#{eno}
		]]>
	</select>
    
    <select id="total" parameterType="Map" resultType="int">
		select count(*) from users
		<where>
			<choose>
				<when test="col=='u_ID'">
					u_ID like '%'||#{word}||'%'
				</when>
				<when test="col=='name'">
					name like '%'||#{word}||'%'
				</when>
			</choose>
		</where>
	</select>
	
</mapper>

